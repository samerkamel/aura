# Story 2.1: Configure Standard Work Hours & Weekends

## Status: Complete

## Story

- **As an** Admin
- **I want** to set the standard required work hours per day and define the official weekends
- **so that** the system can calculate the required monthly work hours for payroll.

## Acceptance Criteria (ACs)

1.  ✅ A new "Attendance Settings" page is available in the admin panel.
2.  ✅ On this page, an Admin can input a numeric value for "Standard Work Hours per Day" (e.g., 8).
3.  ✅ The Admin can select the official weekend days using a multi-select or a series of checkboxes (e.g., Friday and Saturday).
4.  ✅ When saved, these values become the system-wide default for all relevant calculations.
5.  ✅ The settings form must be pre-populated with the currently saved values when the page is loaded.
6.  ✅ Input must be validated (e.g., hours must be a positive number).

## Tasks / Subtasks

- [x] **Module:** Create the `Attendance` module using `php artisan module:make Attendance`.
- [x] **Migration:** Create a general `settings` table with `key` and `value` columns to store system-wide configurations like these.
- [x] **Controller:** Create a `AttendanceSettingController` within the `Attendance` module with methods to show the settings form and to store the updated values.
- [x] **Routes:** Define the web routes within the `Attendance` module for viewing and updating the settings page.
- [x] **View:** Create a Blade view for the "Attendance Settings" form, using Vuexy components for the number input and day selection controls.
- [x] **Logic:** Implement the logic to save the settings as key-value pairs (e.g., key: 'work_hours_per_day', value: '8'; key: 'weekend_days', value: '["friday", "saturday"]').
- [x] **Testing:** Write a feature test to verify that the settings can be successfully saved and that the form is correctly pre-populated with existing values.

## Dev Technical Guidance

- This is the first story for the new **`Attendance`** module. All related code should be placed within it.
- A general-purpose `settings` table is recommended for this functionality, as it can be reused for other system-wide settings later (e.g., WFH percentage). It should have at a minimum, `key` and `value` columns, where the key is unique.
- Consider creating a helper function or a `SettingsService` class to easily get/set settings by their key from anywhere in the application (e.g., `Settings::get('weekend_days')`).
- When saving the weekend days, storing them as a JSON-encoded array in the `value` column is a flexible approach.

## Story Progress Notes

### Agent Model Used: `Claude 3.5 Sonnet`

### Completion Notes List

- **2025-06-14**: Story initialization - Status updated to InProgress
- **2025-06-14**: Beginning implementation of attendance settings management system
- **2025-06-14**: Created Attendance module successfully
- **2025-06-14**: Fixed AssetManager routes issue and created settings table migration
- **2025-06-14**: Created Setting model, implementing settings management system
- **2025-06-14**: Created AttendanceSettingsController with index and update methods
- **2025-06-14**: Implemented routes for attendance settings management
- **2025-06-14**: Created comprehensive Vuexy-compliant Blade view with form validation
- **2025-06-14**: Created complete test suite covering all functionality (12 tests)
- **2025-06-14**: Fixed Laravel Jetstream dependency issues in navbar template
- **2025-06-14**: Added missing logout route for authentication
- **2025-06-14**: All tests passing successfully - Story completed

### Implementation Summary

✅ **Complete Attendance Settings System** implemented including:

**Database Layer:**

- Settings table with key-value structure for flexible configuration storage
- Unique key constraints and proper indexing
- Migration successfully executed

**Model Layer:**

- Setting model with comprehensive static helper methods (get, set, has, forget, getMultiple)
- JSON encoding/decoding for complex data types
- Proper attribute casting and fillable configuration

**Controller Layer:**

- AttendanceSettingsController with proper validation and error handling
- Form request validation for work hours (0.5-24) and weekend days
- Session feedback for successful updates

**Route Layer:**

- Protected routes with auth and verified middleware
- RESTful naming convention (attendance.settings.index/update)
- Proper route parameter handling

**View Layer:**

- Vuexy-compliant Blade template with modern UI components
- Client-side validation with visual feedback
- Responsive design with proper form controls
- JavaScript enhancements for user experience

**Testing Layer:**

- 12 comprehensive feature tests covering all functionality
- Edge case validation testing
- Persistence verification across requests
- Static model method testing

**Infrastructure Fixes:**

- Resolved Laravel Jetstream dependency issues in navbar template
- Added authentication routes for testing compatibility
- Fixed missing controller references

### Final Result

A fully functional attendance settings management system that allows administrators to configure standard work hours per day (0.5-24 hours) and select weekend days from a comprehensive list. The system uses a flexible key-value storage approach that can be extended for other system settings in the future.

### Change Log

- **2025-06-14**: Started implementation
- **2025-06-14**: Completed full implementation with all tests passing
